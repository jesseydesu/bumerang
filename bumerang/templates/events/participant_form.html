{% extends "events/event_wrapper.html" %}
{% load sitetree %}

{% block title %}Подача заявки на {{ event.title }}{% endblock %}

{% block page_title %}
    <h1>{{ event.title }}</h1>
{% endblock %}

{% block head_css %}
    <link rel="stylesheet" href="{{ STATIC_URL }}s/dropdown.css" />
{% endblock %}

{% block head_js %}
    <script type="text/javascript" src="{{ STATIC_URL }}j/utils.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}j/festivals.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}j/jquery.formset.js"></script>
{% endblock %}

{% block left_column %}
{#    {% include 'events/snippets/edit_tabs_menu.html' with selected='event' object=event %}#}
{#    <dd class="selected hdr-festival-send-request">#}
{#        <div class="l-cols">#}
{#            <div class="l-cols__bg-section">#}
{#                <div></div>#}
{#            </div>#}
    <header class="b-page-head">
        <h1>{{ event.title }}</h1>
    </header>

    <div class="b-tabs d-sh">
            <div class="l-cols__i cleared" style="padding-top: 16px;">
                <section class="l-cols__section">
                    <div class="l-cols__section__i">
                        <section class="b-form b-form_smaller b-form_edit">
                            {% if event.owner != request.user %}
                            <form name="editform" action="" method="post">
                                {% csrf_token %}

                                <a class="form-profile-view" href="{% url event-detail event.id %}">Вернуться к событию</a>

                                <div>
                                    <h3 class="title">
                                        Подача заявки на участие
                                    </h3>
                                    <p>
                                        Прикрепите ваши работы.
                                    </p>

                                    <div class="b-hr"><hr /></div>

                                    {{ formset.management_form }}

                                    {% for form in formset %}
                                        <fieldset class="field" id="{{ form.prefix }}-row">
                                            {% for hidden in form.hidden_fields %}
                                                {{ hidden }}
                                            {% endfor %}

                                            {% for field in form.visible_fields %}
                                                <fieldset>
                                                    <div class="b-form__field">
                                                        <label>
                                                            <span class="f-title">
                                                                {{ field.label }} {% if field.field.required %}<span class="sp-err">*</span>{% endif %}
                                                            </span>
                                                            <span class="f-input">
                                                                {{ field }}
                                                            </span>
                                                        </label>
                                                        {% if field.errors %}
                                                            <div class="sp-err"><span>{{ field.errors }}</span></div>
                                                        {% endif %}
                                                    </div>
                                                </fieldset>
                                            {% endfor %}

                                            <div class="b-hr"><hr /></div>
                                        </fieldset>

                                    {% endfor %}

                                </div>

                                <footer class="form-footer">
                                    <div class="wrap">
                                        <a href="#" class="b-button b-button_yellow button-submit">Сохранить</a>
                                    </div>
                                </footer>
                            </form>
                            {% else %}
                                <div class="b-form__fields">
                                    <h3 class="title">
                                        Недопустимое действие
                                    </h3>
                                    Организатор фестиваля не может принимать участие в нем
                                </div>
                            {% endif %}

                        </section>
                    </div>
                </section>
            </div>
{#        </div>#}
{#    </dd>#}

    <script type="text/javascript">
        $(function() {
            $('form fieldset.field').formset({
                prefix: 'participantvideo_set',
                addText: '{{ add_item_text }}'
            })
        })
    </script>
    </div>
{% endblock %}

{% block right_menu %}
    <nav class="b-side-nav d-indent" style="margin-top: 60px;">
        <ul>
            <h4>Управление</h4>
            <li>
{#                <a href="{% url profile-event-list request.user.id %}" title="Заполнить заявку">Ваши конкурсы и фестивали</a>#}
            </li>
            <li>
                <a href="{% url event-send-request %}" title="Заполнить заявку">Заполнить заявку</a>
            </li>
        </ul>
        <i class="d-indent__tl"></i>
        <i class="d-indent__tr"></i>
        <i class="d-indent__br"></i>
        <i class="d-indent__bl"></i>
    </nav>
{% endblock %}

{% block popup %}
    <li class="item template" style="display: none;">
        <a href="#" class="list-item-link">
            <div class="content">
                <div class="preview-container">
                    <img class="preview" src="{{ STATIC_URL }}i/nophoto.png"/>
                </div>

                <p class="text"></p>
            </div>
            <div class="b-hr"><hr /></div>
        </a>
    </li>
{% endblock %}
